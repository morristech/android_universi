<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UniversiActivity.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">universum.studios.android.universi</a> &gt; <span class="el_source">UniversiActivity.java</span></div><h1>UniversiActivity.java</h1><pre class="source lang-java linenums">/*
 * =================================================================================================
 *                             Copyright (C) 2017 Universum Studios
 * =================================================================================================
 *         Licensed under the Apache License, Version 2.0 or later (further &quot;License&quot; only).
 * -------------------------------------------------------------------------------------------------
 * You may use this file only in compliance with the License. More details and copy of this License 
 * you may obtain at
 * 
 * 		http://www.apache.org/licenses/LICENSE-2.0
 * 
 * You can redistribute, modify or publish any part of the code written within this file but as it 
 * is described in the License, the software distributed under the License is distributed on an 
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES or CONDITIONS OF ANY KIND.
 * 
 * See the License for the specific language governing permissions and limitations under the License.
 * =================================================================================================
 */
package universum.studios.android.universi;

import android.app.ActionBar;
import android.app.Activity;
import android.app.Fragment;
import android.app.LoaderManager;
import android.content.Loader;
import android.content.pm.PackageManager;
import android.os.Build;
import android.os.Bundle;
import android.os.Looper;
import android.support.annotation.IntRange;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.support.annotation.UiThread;
import android.support.annotation.VisibleForTesting;
import android.support.annotation.XmlRes;
import android.support.v4.app.ActivityCompat;
import android.view.Menu;
import android.widget.Toolbar;

import universum.studios.android.dialog.DialogOptions;
import universum.studios.android.dialog.manage.DialogController;
import universum.studios.android.dialog.manage.DialogFactory;
import universum.studios.android.fragment.ActionBarDelegate;
import universum.studios.android.fragment.BackPressWatcher;
import universum.studios.android.fragment.annotation.ActionBarOptions;
import universum.studios.android.fragment.annotation.FragmentAnnotations;
import universum.studios.android.fragment.annotation.MenuOptions;
import universum.studios.android.fragment.annotation.handler.ActionBarAnnotationHandlers;
import universum.studios.android.fragment.annotation.handler.ActionBarFragmentAnnotationHandler;
import universum.studios.android.fragment.manage.FragmentController;
import universum.studios.android.fragment.manage.FragmentFactory;
import universum.studios.android.transition.BaseNavigationalTransition;

/**
 * An {@link Activity} implementation that provides &lt;b&gt;Universi context&lt;/b&gt; features via
 * {@link UniversiActivityDelegate} including other features described below.
 *
 * &lt;h3&gt;1) Data binding&lt;/h3&gt;
 * Whether it is used data binding provided by &lt;a href=&quot;http://developer.android.com/tools/data-binding/guide.html&quot;&gt;Google&lt;/a&gt;
 * to bind application logic and layouts or some custom data binding logic, this activity class provides
 * a simple way to manage data binding requests and to perform actual binding. Whether a new data need
 * to be bound to a view hierarchy of a specific instance of UniversiActivity, {@link #requestBindData()}
 * need to be called. &lt;b&gt;This method can be invoked from any thread.&lt;/b&gt; If data binding request has
 * been registered, UniversiActivity will invoke {@link #onBindData()} method whenever its view
 * hierarchy is already created or waits until it is created.
 *
 * &lt;h3&gt;1) Permissions&lt;/h3&gt;
 * This activity class has support for a new permissions management model introduced in the
 * {@link Build.VERSION_CODES#M Marshmallow} Android version. Permissions related methods like
 * {@link #checkSelfPermission(String)} or {@link #supportRequestPermissions(String[], int)} can be
 * invoked regardless of current Android version.
 *
 * @author Martin Albedinsky
 * @see UniversiCompatActivity
 * @see UniversiFragment
 */
public abstract class UniversiActivity extends Activity implements UniversiActivityContext {

	/*
	 * Constants ===================================================================================
	 */

	/**
	 * Log TAG.
	 */
	// private static final String TAG = &quot;UniversiActivity&quot;;

	/*
	 * Interface ===================================================================================
	 */

	/*
	 * Static members ==============================================================================
	 */

	/*
	 * Members =====================================================================================
	 */

	/**
	 * Runnable that calls {@link #requestBindDataInner()} method.
	 */
<span class="fc" id="L103">	@VisibleForTesting final Runnable REQUEST_BIND_DATA_INNER = new Runnable() {</span>

		/**
		 */
		@Override
		public void run() {
<span class="fc" id="L109">			requestBindDataInner();</span>
<span class="fc" id="L110">		}</span>
	};

	/**
	 * Handler responsible for processing of all annotations of this class and also for handling all
	 * annotations related operations for this class.
	 */
	final ActionBarFragmentAnnotationHandler mAnnotationHandler;

	/**
	 * Delegate that is used to handle requests specific for the Universi context made upon this activity
	 * like showing and dismissing of dialogs or showing and hiding of fragments.
	 */
	private UniversiActivityDelegate mContextDelegate;

	/*
	 * Constructors ================================================================================
	 */

	/**
	 * Creates a new instance of UniversiActivity. If annotations processing is enabled via
	 * {@link FragmentAnnotations#setEnabled(boolean)} all annotations supported by this activity
	 * class will be processed/obtained here so they can be later used.
	 */
	public UniversiActivity() {
<span class="fc" id="L135">		super();</span>
<span class="fc" id="L136">		this.mAnnotationHandler = onCreateAnnotationHandler();</span>
<span class="fc" id="L137">	}</span>

	/*
	 * Methods =====================================================================================
	 */

	/**
	 * Invoked to create annotations handler for this instance.
	 *
	 * @return Annotations handler specific for this class.
	 */
	ActionBarFragmentAnnotationHandler onCreateAnnotationHandler() {
<span class="fc" id="L149">		return ActionBarAnnotationHandlers.obtainActionBarFragmentHandler(getClass());</span>
	}

	/**
	 * Returns handler that is responsible for annotations processing of this class and also for
	 * handling all annotations related operations for this class.
	 *
	 * @return Annotations handler specific for this class.
	 * @throws IllegalStateException If annotations processing is not enabled for the Fragments library.
	 */
	@NonNull
	protected ActionBarFragmentAnnotationHandler getAnnotationHandler() {
<span class="fc" id="L161">		FragmentAnnotations.checkIfEnabledOrThrow();</span>
<span class="fc" id="L162">		return mAnnotationHandler;</span>
	}

	/**
	 * Sets a context delegate to be used by this activity.
	 *
	 * @param delegate The delegate only for testing purpose.
	 */
	@VisibleForTesting void setContextDelegate(final UniversiActivityDelegate delegate) {
<span class="fc" id="L171">		this.mContextDelegate = delegate;</span>
<span class="fc" id="L172">	}</span>

	/**
	 * Ensures that the context delegate is initialized for this activity.
	 */
	private void ensureContextDelegate() {
<span class="fc bfc" id="L178" title="All 2 branches covered.">		if (mContextDelegate == null) this.mContextDelegate = UniversiContextDelegate.create(this);</span>
<span class="fc" id="L179">	}</span>

	/**
	 */
	@Override
	protected void onCreate(@Nullable final Bundle savedInstanceState) {
<span class="fc" id="L185">		super.onCreate(savedInstanceState);</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">		if (mAnnotationHandler != null) {</span>
<span class="fc" id="L187">			final int viewResource = mAnnotationHandler.getContentViewResource(-1);</span>
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">			if (viewResource != -1) {</span>
<span class="fc" id="L189">				setContentView(viewResource);</span>
			}
		}
<span class="fc" id="L192">	}</span>

	/**
	 */
	@Nullable
	@Override
	public &lt;D&gt; Loader&lt;D&gt; startLoader(final int id, @Nullable final Bundle params, @NonNull final LoaderManager.LoaderCallbacks&lt;D&gt; callbacks) {
<span class="fc" id="L199">		this.ensureContextDelegate();</span>
<span class="fc" id="L200">		return mContextDelegate.startLoader(id, params, callbacks);</span>
	}

	/**
	 */
	@Nullable
	@Override
	public &lt;D&gt; Loader&lt;D&gt; initLoader(final int id, @Nullable final Bundle params, @NonNull final LoaderManager.LoaderCallbacks&lt;D&gt; callbacks) {
<span class="fc" id="L208">		this.ensureContextDelegate();</span>
<span class="fc" id="L209">		return mContextDelegate.initLoader(id, params, callbacks);</span>
	}

	/**
	 */
	@Nullable
	@Override
	public &lt;D&gt; Loader&lt;D&gt; restartLoader(final int id, @Nullable final Bundle params, @NonNull final LoaderManager.LoaderCallbacks&lt;D&gt; callbacks) {
<span class="fc" id="L217">		this.ensureContextDelegate();</span>
<span class="fc" id="L218">		return mContextDelegate.restartLoader(id, params, callbacks);</span>
	}

	/**
	 */
	@Override
	public void destroyLoader(int id) {
<span class="fc" id="L225">		this.ensureContextDelegate();</span>
<span class="fc" id="L226">		mContextDelegate.destroyLoader(id);</span>
<span class="fc" id="L227">	}</span>

	/**
	 */
	@Override
	public void onContentChanged() {
<span class="fc" id="L233">		super.onContentChanged();</span>
<span class="fc" id="L234">		this.ensureContextDelegate();</span>
<span class="fc" id="L235">		mContextDelegate.setViewCreated(true);</span>
<span class="fc" id="L236">		this.configureActionBar(getActionBar());</span>
<span class="fc" id="L237">		onBindViews();</span>
		// Check if there was requested data binding before view creation, if it was, perform binding now.
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">		if (mContextDelegate.isRequestRegistered(UniversiContextDelegate.REQUEST_BIND_DATA)) {</span>
<span class="nc" id="L240">			mContextDelegate.unregisterRequest(UniversiContextDelegate.REQUEST_BIND_DATA);</span>
<span class="nc" id="L241">			onBindData();</span>
		}
<span class="fc" id="L243">	}</span>

	/**
	 */
	@Override
	public void setActionBar(@Nullable final Toolbar toolbar) {
<span class="nc" id="L249">		super.setActionBar(toolbar);</span>
<span class="nc" id="L250">		this.configureActionBar(getActionBar());</span>
<span class="nc" id="L251">	}</span>

	/**
	 * Called to configure the given &lt;var&gt;actionBar&lt;/var&gt; according to the {@link ActionBarOptions @ActionBarOptions}
	 * annotation (if presented).
	 */
	private void configureActionBar(final ActionBar actionBar) {
<span class="pc bpc" id="L258" title="3 of 4 branches missed.">		if (actionBar == null || mAnnotationHandler == null) return;</span>
<span class="nc" id="L259">		mAnnotationHandler.configureActionBar(ActionBarDelegate.create(this, actionBar));</span>
<span class="nc" id="L260">	}</span>

	/**
	 * Invoked from {@link #onContentChanged()} to bind all views presented within context of this
	 * activity.
	 */
	protected void onBindViews() {
		// Inheritance hierarchies may perform here views binding/injection.
<span class="fc" id="L268">	}</span>

	/**
	 */
	@Override
	public boolean onCreateOptionsMenu(@NonNull final Menu menu) {
<span class="pc bpc" id="L274" title="1 of 4 branches missed.">		if (mAnnotationHandler == null || !mAnnotationHandler.hasOptionsMenu()) {</span>
<span class="fc" id="L275">			return false;</span>
		}
<span class="nc" id="L277">		final int menuResource = mAnnotationHandler.getOptionsMenuResource(-1);</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (menuResource == -1) {</span>
<span class="nc" id="L279">			return super.onCreateOptionsMenu(menu);</span>
		}
<span class="nc bnc" id="L281" title="All 2 branches missed.">		if (mAnnotationHandler.shouldClearOptionsMenu()) {</span>
<span class="nc" id="L282">			menu.clear();</span>
		}
<span class="nc bnc" id="L284" title="All 3 branches missed.">		switch (mAnnotationHandler.getOptionsMenuFlags(0)) {</span>
			case MenuOptions.IGNORE_SUPER:
<span class="nc" id="L286">				getMenuInflater().inflate(menuResource, menu);</span>
<span class="nc" id="L287">				break;</span>
			case MenuOptions.BEFORE_SUPER:
<span class="nc" id="L289">				getMenuInflater().inflate(menuResource, menu);</span>
<span class="nc" id="L290">				super.onCreateOptionsMenu(menu);</span>
<span class="nc" id="L291">				break;</span>
			case MenuOptions.DEFAULT:
			default:
<span class="nc" id="L294">				super.onCreateOptionsMenu(menu);</span>
<span class="nc" id="L295">				getMenuInflater().inflate(menuResource, menu);</span>
				break;
		}
<span class="nc" id="L298">		return true;</span>
	}

	/**
	 */
	@Override
	public void setNavigationalTransition(@Nullable final BaseNavigationalTransition transition) {
<span class="fc" id="L305">		this.ensureContextDelegate();</span>
<span class="fc" id="L306">		mContextDelegate.setNavigationalTransition(transition);</span>
<span class="fc" id="L307">	}</span>

	/**
	 */
	@Override
	@Nullable
	public BaseNavigationalTransition getNavigationalTransition() {
<span class="fc" id="L314">		this.ensureContextDelegate();</span>
<span class="fc" id="L315">		return mContextDelegate.getNavigationalTransition();</span>
	}

	/**
	 */
	@Override
	public void setFragmentController(@Nullable FragmentController controller) {
<span class="fc" id="L322">		this.ensureContextDelegate();</span>
<span class="fc" id="L323">		mContextDelegate.setFragmentController(controller);</span>
<span class="fc" id="L324">	}</span>

	/**
	 */
	@Override
	@NonNull
	public FragmentController getFragmentController() {
<span class="fc" id="L331">		this.ensureContextDelegate();</span>
<span class="fc" id="L332">		return mContextDelegate.getFragmentController();</span>
	}

	/**
	 */
	@Override
	public void setFragmentFactory(@Nullable final FragmentFactory factory) {
<span class="fc" id="L339">		this.ensureContextDelegate();</span>
<span class="fc" id="L340">		mContextDelegate.setFragmentFactory(factory);</span>
<span class="fc" id="L341">	}</span>

	/**
	 */
	@Override
	@Nullable
	public FragmentFactory getFragmentFactory() {
<span class="fc" id="L348">		this.ensureContextDelegate();</span>
<span class="fc" id="L349">		return mContextDelegate.getFragmentFactory();</span>
	}

	/**
	 */
	@Override
	public void setDialogController(@Nullable final DialogController controller) {
<span class="fc" id="L356">		this.ensureContextDelegate();</span>
<span class="fc" id="L357">		mContextDelegate.setDialogController(controller);</span>
<span class="fc" id="L358">	}</span>

	/**
	 */
	@Override
	@NonNull
	public DialogController getDialogController() {
<span class="fc" id="L365">		this.ensureContextDelegate();</span>
<span class="fc" id="L366">		return mContextDelegate.getDialogController();</span>
	}

	/**
	 */
	@Override
	public void setDialogXmlFactory(@XmlRes final int xmlDialogsSet) {
<span class="fc" id="L373">		this.ensureContextDelegate();</span>
<span class="fc" id="L374">		mContextDelegate.setDialogXmlFactory(xmlDialogsSet);</span>
<span class="fc" id="L375">	}</span>

	/**
	 */
	@Override
	public void setDialogFactory(@Nullable final DialogFactory factory) {
<span class="fc" id="L381">		this.ensureContextDelegate();</span>
<span class="fc" id="L382">		mContextDelegate.setDialogFactory(factory);</span>
<span class="fc" id="L383">	}</span>

	/**
	 */
	@Override
	@Nullable
	public DialogFactory getDialogFactory() {
<span class="fc" id="L390">		this.ensureContextDelegate();</span>
<span class="fc" id="L391">		return mContextDelegate.getDialogFactory();</span>
	}

	/**
	 * Requests performing of data binding specific for this activity via {@link #onBindData()}.
	 * If this activity has its view hierarchy already created {@link #onBindData()} will be invoked
	 * immediately, otherwise will wait until {@link #onContentChanged()} is invoked.
	 * &lt;p&gt;
	 * &lt;b&gt;This method may be invoked also from a background-thread&lt;/b&gt;.
	 */
	protected void requestBindData() {
		// Check whether this call has been made on the UI thread, if not post on the UI thread the request runnable.
<span class="fc bfc" id="L403" title="All 2 branches covered.">		if (Looper.getMainLooper().equals(Looper.myLooper())) {</span>
<span class="fc" id="L404">			this.requestBindDataInner();</span>
		} else {
<span class="fc" id="L406">			runOnUiThread(REQUEST_BIND_DATA_INNER);</span>
		}
<span class="fc" id="L408">	}</span>

	/**
	 * Performs data binding of this activity. Will invoke {@link #onBindData()} if view hierarchy of
	 * this activity is already created, otherwise will register a binding request via {@link UniversiContextDelegate#registerRequest(int)}.
	 */
	final void requestBindDataInner() {
<span class="fc" id="L415">		this.ensureContextDelegate();</span>
<span class="fc bfc" id="L416" title="All 2 branches covered.">		if (mContextDelegate.isViewCreated()) {</span>
<span class="fc" id="L417">			onBindData();</span>
<span class="fc" id="L418">			return;</span>
		}
<span class="fc" id="L420">		mContextDelegate.registerRequest(UniversiContextDelegate.REQUEST_BIND_DATA);</span>
<span class="fc" id="L421">	}</span>

	/**
	 * Invoked due to call to {@link #requestBindData()} to perform data binding specific for this
	 * activity instance.
	 * &lt;p&gt;
	 * &lt;b&gt;This is always invoked on the UI thread.&lt;/b&gt;
	 */
	@UiThread
	protected void onBindData() {
		// Inheritance hierarchies may perform theirs specific data binding logic here.
<span class="fc" id="L432">	}</span>

	/**
	 */
	@Override
	protected void onResume() {
<span class="fc" id="L438">		super.onResume();</span>
<span class="fc" id="L439">		this.ensureContextDelegate();</span>
<span class="fc" id="L440">		mContextDelegate.setPaused(false);</span>
<span class="fc" id="L441">	}</span>

	/**
	 */
	@Override
	public boolean isActiveNetworkConnected() {
<span class="fc" id="L447">		this.ensureContextDelegate();</span>
<span class="fc" id="L448">		return mContextDelegate.isActiveNetworkConnected();</span>
	}

	/**
	 */
	@Override
	public boolean isNetworkConnected(final int networkType) {
<span class="fc" id="L455">		this.ensureContextDelegate();</span>
<span class="fc" id="L456">		return mContextDelegate.isNetworkConnected(networkType);</span>
	}

	/**
	 */
	@Override
	public int checkSelfPermission(@NonNull final String permission) {
<span class="pc bpc" id="L463" title="1 of 2 branches missed.">		return Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M ?</span>
<span class="pc" id="L464">				super.checkSelfPermission(permission) :</span>
				PackageManager.PERMISSION_GRANTED;
	}

	/**
	 */
	@Override
	public boolean shouldShowRequestPermissionRationale(@NonNull final String permission) {
<span class="pc bpc" id="L472" title="2 of 4 branches missed.">		return Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M &amp;&amp; super.shouldShowRequestPermissionRationale(permission);</span>
	}

	/**
	 * Invokes {@link #requestPermissions(String[], int)} on Android versions above {@link Build.VERSION_CODES#M Marshmallow}
	 * (including).
	 * &lt;p&gt;
	 * Calling this method on Android versions before &lt;b&gt;MARSHMALLOW&lt;/b&gt; will be ignored.
	 *
	 * @param permissions The desired set of permissions to request.
	 * @param requestCode Code to identify this request in {@link #onRequestPermissionsResult(int, String[], int[])}.
	 */
	public void supportRequestPermissions(@NonNull final String[] permissions, final int requestCode) {
<span class="nc bnc" id="L485" title="All 2 branches missed.">		if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M)</span>
<span class="nc" id="L486">			requestPermissions(permissions, requestCode);</span>
<span class="nc" id="L487">	}</span>

	/**
	 */
	@Override
	public void onRequestPermissionsResult(final int requestCode, @NonNull final String[] permissions, @NonNull final int[] grantResults) {
<span class="fc" id="L493">		super.onRequestPermissionsResult(requestCode, permissions, grantResults);</span>
<span class="fc" id="L494">	}</span>

	/**
	 */
	@Override
	public boolean showDialogWithId(final int dialogId) {
<span class="fc" id="L500">		return showDialogWithId(dialogId, null);</span>
	}

	/**
	 */
	@Override
	public boolean showDialogWithId(@IntRange(from = 0) final int dialogId, @Nullable final DialogOptions options) {
<span class="fc" id="L507">		this.ensureContextDelegate();</span>
<span class="fc" id="L508">		return mContextDelegate.showDialogWithId(dialogId, options);</span>
	}

	/**
	 */
	@Override
	public boolean dismissDialogWithId(@IntRange(from = 0) final int dialogId) {
<span class="fc" id="L515">		this.ensureContextDelegate();</span>
<span class="fc" id="L516">		return mContextDelegate.dismissDialogWithId(dialogId);</span>
	}

	/**
	 */
	@Override
	public boolean showXmlDialog(@XmlRes final int resId) {
<span class="fc" id="L523">		return showXmlDialog(resId, null);</span>
	}

	/**
	 */
	@Override
	public boolean showXmlDialog(@XmlRes final int resId, @Nullable final DialogOptions options) {
<span class="fc" id="L530">		this.ensureContextDelegate();</span>
<span class="fc" id="L531">		return mContextDelegate.showXmlDialog(resId, options);</span>
	}

	/**
	 */
	@Override
	public boolean dismissXmlDialog(@XmlRes final int resId) {
<span class="fc" id="L538">		this.ensureContextDelegate();</span>
<span class="fc" id="L539">		return mContextDelegate.dismissXmlDialog(resId);</span>
	}

	/**
	 */
	@Override
	public void onBackPressed() {
<span class="fc bfc" id="L546" title="All 2 branches covered.">		if (!onBackPress()) finishWithNavigationalTransition();</span>
<span class="fc" id="L547">	}</span>

	/**
	 * Invoked from {@link #onBackPressed()} to give a chance to this activity instance to consume
	 * the back press event before it is delivered to its parent.
	 * &lt;p&gt;
	 * This implementation first tries to dispatch this event to one of its visible fragments via
	 * {@link #dispatchBackPressToFragments()} and if none of the currently visible fragments consumes
	 * the event a stack with fragments will be popped via {@link #popFragmentsBackStack()}.
	 *
	 * @return {@code True} if the back press event has been consumed here, {@code false} otherwise.
	 */
	protected boolean onBackPress() {
<span class="fc" id="L560">		this.ensureContextDelegate();</span>
<span class="fc bfc" id="L561" title="All 6 branches covered.">		return !mContextDelegate.isPaused() &amp;&amp; (dispatchBackPressToFragments() || popFragmentsBackStack());</span>
	}

	/**
	 * Dispatches back press event to all currently visible fragments displayed in context of this
	 * activity.
	 * &lt;p&gt;
	 * This implementation calls {@link #dispatchBackPressToCurrentFragment()} and returns its result.
	 *
	 * @return {@code True} if some of the visible fragments has consumed the back press event,
	 * {@code false} otherwise.
	 * @see BackPressWatcher#dispatchBackPress()
	 */
	protected boolean dispatchBackPressToFragments() {
<span class="fc" id="L575">		return dispatchBackPressToCurrentFragment();</span>
	}

	/**
	 * Dispatches back press event to the current fragment displayed in context of this activity.
	 *
	 * @return {@code True} if the current fragment has consumed the back press event, {@code false}
	 * otherwise.
	 * @see #findCurrentFragment()
	 * @see BackPressWatcher#dispatchBackPress()
	 */
	protected boolean dispatchBackPressToCurrentFragment() {
<span class="fc" id="L587">		final Fragment fragment = findCurrentFragment();</span>
<span class="fc bfc" id="L588" title="All 4 branches covered.">		return fragment instanceof BackPressWatcher &amp;&amp; ((BackPressWatcher) fragment).dispatchBackPress();</span>
	}

	/**
	 * Finds currently visible fragment that is displayed in context of this activity.
	 * &lt;p&gt;
	 * &lt;b&gt;Note, that implementation of this method assumes that this activity uses {@link FragmentController}
	 * to display its related fragments and that there may be only one fragment visible at a time,
	 * that is in a full screen container.&lt;/b&gt;
	 *
	 * @return Current fragment of this activity (that is at this time visible), or {@code null} if
	 * there is no fragment presented within fragment container of this activity at all.
	 */
	@Nullable
	protected Fragment findCurrentFragment() {
<span class="fc" id="L603">		this.ensureContextDelegate();</span>
<span class="fc" id="L604">		return mContextDelegate.findCurrentFragment();</span>
	}

	/**
	 * Pops stack with fragments of this activity.
	 *
	 * @return {@code True} if there was some fragment popped from the stack, {@code false} if there
	 * were no fragments to pop from.
	 */
	protected boolean popFragmentsBackStack() {
<span class="fc" id="L614">		this.ensureContextDelegate();</span>
<span class="fc" id="L615">		return mContextDelegate.popFragmentsBackStack();</span>
	}

	/**
	 */
	@Override
	protected void onPause() {
<span class="fc" id="L622">		super.onPause();</span>
<span class="fc" id="L623">		this.ensureContextDelegate();</span>
<span class="fc" id="L624">		mContextDelegate.setPaused(true);</span>
<span class="fc" id="L625">	}</span>

	/**
	 */
	@Override
	public boolean finishWithNavigationalTransition() {
<span class="fc" id="L631">		this.ensureContextDelegate();</span>
<span class="fc bfc" id="L632" title="All 2 branches covered.">		if (mContextDelegate.finishWithNavigationalTransition()) {</span>
<span class="fc" id="L633">			return true;</span>
		}
<span class="fc" id="L635">		ActivityCompat.finishAfterTransition(this);</span>
<span class="fc" id="L636">		return false;</span>
	}

	/**
	 */
	@Override
	protected void onDestroy() {
<span class="fc" id="L643">		super.onDestroy();</span>
<span class="pc bpc" id="L644" title="1 of 2 branches missed.">		if (mContextDelegate != null) mContextDelegate.setViewCreated(false);</span>
<span class="fc" id="L645">	}</span>

	/*
	 * Inner classes ===============================================================================
	 */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.3.2</div></body></html>